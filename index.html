    <!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mars Visit Application</title>
        
        <!-- jQuery and jQuery UI CSS -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="app-container">
            <!-- Stage 1: Personal Information -->
            <div class="form-stage active" id="stage1">
                <div class="form-header">
                    <h1>Personal Information</h1>
                </div>
                <div class="form-body">
                    <!-- Personal Information Fields -->
                    <label id="client-name" class="input-label" for="name">Full Name</label>
                    <span id="name-error" class="error-label">Please enter a valid name.</span>

                    <label class="input-label" for="dob">Date of Birth *</label>
                    <input type="date" id="dob" name="dob" required>
                    <span id="dob-error" class="error-label"">Please enter a date of birth.</span>

                    <label class="input-label" for="nationality">Nationality</label>
                    <div class="input-group">
                        <select id="nationality" name="nationality" required>
                            <option value="US">United States</option>
                            <option value="AU">Australia</option>
                            <option value="CA">Canada</option>
                            <option value="CN">China</option>
                            <option value="FR">France</option>
                            <option value="DE">Germany</option>
                            <option value="IN">India</option>
                            <option value="IT">Italy</option>
                            <option value="JP">Japan</option>
                            <option value="MX">Mexico</option>
                            <option value="NG">Nigeria</option>
                            <option value="PK">Pakistan</option>
                            <option value="RU">Russia</option>
                            <option value="KR">South Korea</option>
                            <option value="ES">Spain</option>
                            <option value="SE">Sweden</option>
                            <option value="UK">United Kingdom</option>
                            <option value="UK">Other</option>
                        </select>
                    </div>

                    <label class="input-label" for="email">Email *</label>
                    <input type="email" id="email" name="email" placeholder="email@example.com *" required>
                    <span id="email-error" class="error-label"">Please enter a valid email address.</span>
                    
                    <label id="client-phone-label" class="input-label" for="phone">Phone *</label>
                </div>
                <div class="form-footer">
                    <button id="back-button1" class="nav-button" disabled>Back</button>
                    <button id="next-button1" class="nav-button" onclick="showStage(2)" disabled>Next</button>
                </div>
            </div>

            <!-- Stage 2: Travel Preferences -->
            <div class="form-stage" id="stage2" style="display: none;">
                <div class="form-header">
                    <h1>Travel Preferences</h1>
                </div>
                <div class="form-body">
                    <!-- Travel Preferences Fields -->
                    <label class="input-label" for="departure">Departure Date *</label>
                    <input type="date" id="departure" name="departure" required>
                    <span id="departure-error" class="error-label"">Please enter a depature date.</span>

                    <label class="input-label" for="return">Return Date *</label>
                    <input type="date" id="return" name="return" required>
                    <span id="return-error" class="error-label"">Return date must be at least 2 weeks after the depature date.</span>

                    <label class="input-label" for="accommodation">Accommodation Preference</label>
                    <select id="accommodation" name="accommodation">
                        <option value="none">No Preference</option>
                        <option value="dome">Mars Habitat Dome</option>
                        <option value="base">Martian Base</option>
                        <option value="igloo">Martian Ice Igloo</option>
                        <option value="station">Orbital Station Stay</option>
                        <option value="rover">Rover Cabin Experience</option>
                        <option value="hotel">Space Hotel</option>
                    </select>

                    <label class="input-label" for="requests">Special Requests or Preferences</label>
                    <textarea id="requests" name="requests"></textarea>
                </div>
                <div class="form-footer">
                    <button id="back-button2" class="nav-button" onclick="showStage(1)">Back</button>
                    <button id="next-button2" class="nav-button" onclick="showStage(3)" disabled>Next</button>
                </div>
            </div>

            <!-- Stage 3: Health and Safety -->
            <div class="form-stage" id="stage3" style="display: none;">
                <div class="form-header">
                    <h1>Health and Safety</h1>
                </div>
                <div class="form-body">
                    <!-- Health and Safety Fields -->
                    <label class="input-label" for="health">Health Declaration</label>
                    <select id="health" name="health" required>
                        <option value="" disabled selected>Select an option</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>

                    <label id="emergency-label" class="input-label" for="emergency">Emergency Contact Information</label>
                    <div id="contact-1" class="contact">
                        Primary Contact *
                    </div>
                    <div id="contact-container"></div>
                    <button id="secondary-button" class="secondary-button">Add Secondary Contact</button>

                    <label class="input-label" for="conditions">Any Medical Conditions</label>
                    <textarea id="conditions" name="conditions"></textarea>
                </div>
                <div class="form-footer">
                    <button id="back-button3" class="nav-button" onclick="showStage(2)">Back</button>
                    <button id="next-button3" class="nav-button" onclick="showStage(4)">Submit</button>
                </div>
            </div>

            <!-- Stage 4: Submission -->
            <div class="form-stage" id="stage4" style="display: none;">
                <div class="form-header">
                    <h1>Application Submitted</h1>
                </div>
                <div class="form-body">
                    <p>Thank you for submitting your application to visit Mars!</p>
                    <p>We have received your information and will review it shortly. You will receive a confirmation email with further details.</p>
                    <p>We look forward to seeing you on your journey to the Red Planet!</p>
                </div>
                <div class="form-footer">
                    <button class="nav-button" onclick="window.location.href='index.html'">Return to Home</button>
                </div>
            </div>
        </div>

        <!-- jQuery and jQuery UI Scripts -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        
        <!-- Custom Scripts -->
        <script src="main.js"></script>
        <script src="fieldValidation.js"></script>
        <script src="createField.js"></script>
        <script src="phone.js"></script>
        <script src="name.js"></script>
            
        <!-- Setup contact input fields -->
        <script type="text/javascript">
            addName("client-name", 'afterend');
            addPhone("client-phone-label", 'afterend', 0);

            addName("contact-1", 'beforeend', 10);
            addPhone("name-fields2", 'afterend', 10);   
        </script>

        <!-- Validate email -->
        <script type="text/javascript">
            const emailField = document.getElementById('email');

            emailField.addEventListener('input', function() {
                const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|net|gov|edu)$/;
                validateField('email', 'email-error', !emailRegex.test(emailField.value), "Please enter a valid email.");
            });
        </script>

        <!-- Handles stage switching, ensuring valid fields -->
        <script type="text/javascript">
            // Function to validate all required fields in the active stage
            function validateActiveStage() {
                const activeStage = document.querySelector('.form-stage.active');
                let isValid = true;

                // Find all required fields in the active stage
                const requiredFields = activeStage.querySelectorAll('[required]');

                requiredFields.forEach(field => {
                    if (field.value.trim().length === 0 || field.classList.contains('error-border')) {
                        isValid = false;
                    }
                });

                return isValid;
            }
            
            // Update the 'Next' button based on validation
            function updateNextButtonState(stageNumber) {
                const nextButton = document.getElementById(`next-button${stageNumber}`);

                if (validateActiveStage() && nextButton) {
                    nextButton.classList.remove('disabled');
                    nextButton.disabled = false;
                } else if (nextButton) {
                    nextButton.classList.add('disabled');
                    nextButton.disabled = true;
                }
            }

            // Add event listeners to form fields in the active stage on page load
            function addFieldListeners(stageNumber) {
                const activeStage = document.querySelector('.form-stage.active');
                const fields = activeStage.querySelectorAll('[required]');

                fields.forEach(field => {
                    field.addEventListener('input', () => {
                        updateNextButtonState(stageNumber);
                    });
                    field.addEventListener('change', () => {
                        updateNextButtonState(stageNumber);
                    });
                });
            }

            // Function to switch between stages
            function showStage(stageNumber) {

                // Adds a short 0.1 delay for buttons to finish their animation, to improve visual feedback of user response
                setTimeout(() => {
                    const stages = document.querySelectorAll('.form-stage');
                    
                    stages.forEach((stage, index) => {
                        if (index + 1 === stageNumber) {
                            stage.classList.add('active');
                            stage.style.display = 'block';
                        } else {
                            stage.classList.remove('active');
                            stage.style.display = 'none';
                        }
                    });
                    
                    addFieldListeners(stageNumber); // Add listeners for the new active stage
                    updateNextButtonState(stageNumber); // Update the button state for the new active stage
                }, BUTTON_DELAY);
            }

            // Ensure listeners are added when a stage becomes active
            document.addEventListener('DOMContentLoaded', addFieldListeners);
            document.addEventListener('DOMContentLoaded', () => showStage(3));
        </script>

        <!-- Validate date of birth -->
        <script type="text/javascript">
            function validateDOB() {
                const dobValue = new Date(document.getElementById('dob').value);
                const today = new Date();
                const minDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
                const maxDate = new Date(today.getFullYear() - 150, today.getMonth(), today.getDate());

                if (!validateField('dob', 'dob-error', dobValue > today, "Please enter a valid age."))
                    return;
                if (!validateField('dob', 'dob-error', dobValue < maxDate, "Birth year must be within 150 years from today."))
                    return;
                validateField('dob', 'dob-error', dobValue > minDate, "You must be 18 years old or older.");
            }

            document.getElementById('dob').addEventListener('input', validateDOB);
        </script>

        <!-- Validate departure and return dates -->
        <script type="text/javascript">
            function validateDates() {
                const departureField = document.getElementById('departure');
                const returnField = document.getElementById('return');

                const today = new Date();
                const departureDate = new Date(departureField.value);
                const returnDate = new Date(returnField.value);
                const twoWeeksLater = new Date(departureDate);
                const oneYearLater = new Date(departureDate);
                const maxFutureDate = new Date(today);

                maxFutureDate.setFullYear(today.getFullYear() + 5);
                twoWeeksLater.setDate(departureDate.getDate() + 14);
                oneYearLater.setFullYear(departureDate.getFullYear() + 1);

                if (!validateField('departure', 'departure-error', departureDate < today, "Departure date can't be in the past.")) 
                    return;
                if (!validateField('departure', 'departure-error', departureDate > maxFutureDate, `Departure date can't be more than 5 years from today.`)) 
                    return;
                if (!validateField('return', 'return-error', returnDate < twoWeeksLater, "Return date must be at least 14 days after the departure date.")) 
                    return;
                validateField('return', 'return-error', returnDate > oneYearLater, "Return date can't be more than 1 year after the departure date.");
            }

            document.getElementById('departure').addEventListener('input', validateDates);
            document.getElementById('return').addEventListener('input', validateDates);
        </script>

        <!-- Handles event for secondary contact button -->
        <script type="text/javascript">
            document.getElementById('secondary-button').addEventListener('click', function() {
                const addButton = this;
                const contactContainer = document.getElementById('contact-container');
            
                console.log("hello");

                // Step 1: Fade out the button
                addButton.classList.add('fade-out');
            
                setTimeout(() => {
                    // Step 2: Remove the button from the DOM after fading out
                    addButton.style.display = 'none';
            
                    // Step 3: Create new fields for the second contact
                    const newContact = document.createElement('div');
                    newContact.className = 'contact-section fade-in';
            
                    newContact.innerHTML = `
                        <div class="contact-header">Contact 2</div>
                        <div class="contact-body">
                            <!-- Example fields for Contact 2 -->
                            <label for="second-contact-name">Name:</label>
                            <input type="text" id="second-contact-name" name="second-contact-name" required>
            
                            <label for="second-contact-phone">Phone:</label>
                            <input type="tel" id="second-contact-phone" name="second-contact-phone" required>
                        </div>
                    `;
            
                    // Step 4: Append the new fields to the contact container
                    contactContainer.appendChild(newContact);
            
                    // Step 5: Trigger fade-in effect
                    setTimeout(() => {
                        newContact.classList.add('show');
                    }, 10); // Small delay to allow the element to be in the DOM before applying opacity
            
                    // Step 6: Adjust the form size smoothly
                    contactContainer.style.maxHeight = contactContainer.scrollHeight + "px";
                }, 300); // Match the timeout to the button's fade-out duration
            });
        </script>
    </body>
    </html>

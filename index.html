    <!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Mars Visit Application</title>
        
        <!-- jQuery and jQuery UI CSS -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="app-container">
            <!-- Stage 1: Personal Information -->
            <div class="form-stage active" id="stage1">
                <div class="form-header">
                    <h1>Personal Information</h1>
                </div>
                <div class="form-body">
                    <!-- Personal Information Fields -->
                    <label id="client-name" class="input-label" for="name">Full Name</label>
                    <span id="name-error" class="error-label">Please enter a valid name.</span>

                    <label class="input-label" for="dob">Date of Birth *</label>
                    <input type="date" id="dob" name="dob" required>
                    <span id="dob-error" class="error-label"">Please enter a date of birth.</span>

                    <label class="input-label" for="nationality">Nationality</label>
                    <div class="input-group">
                        <select id="nationality" name="nationality" required>
                            <option value="US">United States</option>
                            <option value="AU">Australia</option>
                            <option value="CA">Canada</option>
                            <option value="CN">China</option>
                            <option value="FR">France</option>
                            <option value="DE">Germany</option>
                            <option value="IN">India</option>
                            <option value="IT">Italy</option>
                            <option value="JP">Japan</option>
                            <option value="MX">Mexico</option>
                            <option value="NG">Nigeria</option>
                            <option value="PK">Pakistan</option>
                            <option value="RU">Russia</option>
                            <option value="KR">South Korea</option>
                            <option value="ES">Spain</option>
                            <option value="SE">Sweden</option>
                            <option value="UK">United Kingdom</option>
                            <option value="UK">Other</option>
                        </select>
                    </div>

                    <label class="input-label" for="email">Email *</label>
                    <input type="email" id="email" name="email" placeholder="email@example.com *" required>
                    <span id="email-error" class="error-label"">Please enter a valid email address.</span>
                    
                    <label id="client-phone-label" class="input-label" for="phone">Phone *</label>
                </div>
                <div class="form-footer">
                    <button id="back-button1" class="nav-button" disabled>Back</button>
                    <button id="next-button1" class="nav-button" onclick="showStage(2)" disabled>Next</button>
                </div>
            </div>

            <!-- Stage 2: Travel Preferences -->
            <div class="form-stage" id="stage2" style="display: none;">
                <div class="form-header">
                    <h1>Travel Preferences</h1>
                </div>
                <div class="form-body">
                    <!-- Travel Preferences Fields -->
                    <label class="input-label" for="departure">Departure Date *</label>
                    <input type="date" id="departure" name="departure" required>
                    <span id="departure-error" class="error-label"">Please enter a depature date.</span>

                    <label class="input-label" for="return">Return Date *</label>
                    <input type="date" id="return" name="return" required>
                    <span id="return-error" class="error-label"">Return date must be at least 2 weeks after the depature date.</span>

                    <label class="input-label" for="accommodation">Accommodation Preference</label>
                    <select id="accommodation" name="accommodation">
                        <option value="none">No Preference</option>
                        <option value="dome">Mars Habitat Dome</option>
                        <option value="base">Martian Base</option>
                        <option value="igloo">Martian Ice Igloo</option>
                        <option value="station">Orbital Station Stay</option>
                        <option value="rover">Rover Cabin Experience</option>
                        <option value="hotel">Space Hotel</option>
                    </select>

                    <label class="input-label" for="requests">Special Requests or Preferences</label>
                    <textarea id="requests" name="requests"></textarea>
                </div>
                <div class="form-footer">
                    <button id="back-button2" class="nav-button" onclick="showStage(1)">Back</button>
                    <button id="next-button2" class="nav-button" onclick="showStage(3)" disabled>Next</button>
                </div>
            </div>

            <!-- Stage 3: Health and Safety -->
            <div class="form-stage" id="stage3" style="display: none;">
                <div class="form-header">
                    <h1>Health and Safety</h1>
                </div>
                <div class="form-body">
                    <!-- Health and Safety Fields -->
                    <label class="input-label" for="health">Health Declaration</label>
                    <select id="health" name="health" required>
                        <option value="" disabled selected>Select an option</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>

                    <label id="emergency-label" class="input-label" for="emergency">Emergency Contact Information</label>

                    <label class="input-label" for="conditions">Any Medical Conditions</label>
                    <textarea id="conditions" name="conditions"></textarea>
                </div>
                <div class="form-footer">
                    <button id="back-button3" class="nav-button" onclick="showStage(2)">Back</button>
                    <button id="next-button3" class="nav-button" onclick="showStage(4)">Submit</button>
                </div>
            </div>

            <!-- Stage 4: Submission -->
            <div class="form-stage" id="stage4" style="display: none;">
                <div class="form-header">
                    <h1>Application Submitted</h1>
                </div>
                <div class="form-body">
                    <p>Thank you for submitting your application to visit Mars!</p>
                    <p>We have received your information and will review it shortly. You will receive a confirmation email with further details.</p>
                    <p>We look forward to seeing you on your journey to the Red Planet!</p>
                </div>
                <div class="form-footer">
                    <button class="nav-button" onclick="window.location.href='index.html'">Return to Home</button>
                </div>
            </div>

        <!-- jQuery and jQuery UI Scripts -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

        <!-- Custom Scripts -->
        <script src="phone.js"></script>
        <script src="name.js"></script>

        <!-- Setup contact input fields -->
        <script type="text/javascript">
            addName("client-name");
            addName("emergency-label");
            addPhone("client-phone-label", 0);
            addPhone("name-fields2", 15);   
        </script>

        <!-- Validate email -->
        <script type="text/javascript">
            document.getElementById('email').addEventListener('input', function() {
                const emailField = this;
                const emailError = document.getElementById('email-error');
                const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|net|gov|edu)$/;

                if (!emailRegex.test(emailField.value)) {
                    emailField.classList.add('error-border');
                    emailError.style.display = 'block';
                } else {
                    emailField.classList.remove('error-border');
                    emailError.style.display = 'none';
                }
            });
        </script>

        <!-- Handles stage switching, ensuring valid fields -->
        <script type="text/javascript">
            // Function to validate all required fields in the active stage
            function validateActiveStage() {
                const activeStage = document.querySelector('.form-stage.active');
                let isValid = true;

                // Find all required fields in the active stage
                const requiredFields = activeStage.querySelectorAll('[required]');

                requiredFields.forEach(field => {
                    if (field.value.trim().length === 0 || field.classList.contains('error-border')) {
                        isValid = false;
                    }
                });

                return isValid;
            }
            // Update the 'Next' button based on validation
            function updateNextButtonState(stageNumber) {
                const nextButton = document.getElementById(`next-button${stageNumber}`);

                if (validateActiveStage() && nextButton) {
                    nextButton.classList.remove('disabled');
                    nextButton.disabled = false;
                } else if (nextButton) {
                    nextButton.classList.add('disabled');
                    nextButton.disabled = true;
                }
            }

            // Add event listeners to form fields in the active stage on page load
            function addFieldListeners(stageNumber) {
                const activeStage = document.querySelector('.form-stage.active');
                const fields = activeStage.querySelectorAll('[required]');

                fields.forEach(field => {
                    field.addEventListener('input', () => {
                        updateNextButtonState(stageNumber);
                    });
                    field.addEventListener('change', () => {
                        updateNextButtonState(stageNumber);
                    });
                });
            }

            // Function to switch between stages
            function showStage(stageNumber) {
                const stages = document.querySelectorAll('.form-stage');

                stages.forEach((stage, index) => {
                    if (index + 1 === stageNumber) {
                        stage.classList.add('active');
                        stage.style.display = 'block';
                    } else {
                        stage.classList.remove('active');
                        stage.style.display = 'none';
                    }
                });

                addFieldListeners(stageNumber); // Add listeners for the new active stage
                updateNextButtonState(stageNumber); // Update the button state for the new active stage
            }


            // Ensure listeners are added when a stage becomes active
            document.addEventListener('DOMContentLoaded', addFieldListeners);
            document.addEventListener('DOMContentLoaded', () => showStage(1));
        </script>

        <!-- Validate date of birth -->
        <script type="text/javascript">
            function validateDOB(dobFieldId) {
                const dobField = document.getElementById(dobFieldId);
                const dobError = document.getElementById('dob-error');
                const dobValue = new Date(dobField.value);
                const today = new Date();
                const maxDate = new Date();
                maxDate.setFullYear(today.getFullYear() - 150);

                if (dobValue > today || dobValue < maxDate) {
                    dobField.classList.add('error-border');
                    dobError.style.display = 'block';
                    return false;
                } else {
                    dobField.classList.remove('error-border');
                    dobError.style.display = 'none';
                    return true;
                }
            }

            // Attach the validation function to the DOB field's blur event
            document.getElementById('dob').addEventListener('input', function() {
                validateDOB('dob');
            });
        </script>

        <!-- Validate departure and return dates -->
        <script type="text/javascript">
            function validateDateField(fieldId, errorId, condition, errorMessage) {
                const field = document.getElementById(fieldId);
                const error = document.getElementById(errorId);
                if (condition) {
                    field.classList.add('error-border');
                    error.textContent = errorMessage;
                    error.style.display = 'block';
                    return false;
                } else {
                    field.classList.remove('error-border');
                    error.style.display = 'none';
                    return true;
                }
            }

            function validateDates() {
                const departureField = document.getElementById('departure');
                const returnField = document.getElementById('return');

                const today = new Date();
                const departureDate = new Date(departureField.value);
                const returnDate = new Date(returnField.value);
                const twoWeeksLater = new Date(departureDate);
                const oneYearLater = new Date(departureDate);
                const maxFutureDate = new Date(today);

                maxFutureDate.setFullYear(today.getFullYear() + 5);
                twoWeeksLater.setDate(departureDate.getDate() + 14);
                oneYearLater.setFullYear(departureDate.getFullYear() + 1);

                let isValid = true;

                isValid &&= validateDateField('departure', 'departure-error', departureDate < today, "Departure date can't be in the past.");
                isValid &&= validateDateField('departure', 'departure-error', departureDate > maxFutureDate, `Departure date can't be more than 5 years from today.`);
                isValid &&= validateDateField('return', 'return-error', returnDate < twoWeeksLater, "Return date must be at least 14 days after the departure date.");
                isValid &&= validateDateField('return', 'return-error', returnDate > oneYearLater, "Return date can't be more than 1 year after the departure date.");

                return isValid;
            }

            document.getElementById('departure').addEventListener('input', validateDates);
            document.getElementById('return').addEventListener('input', validateDates);
        </script>
    </body>
    </html>
